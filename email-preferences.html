<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Preferences - Therapair</title>
    <meta name="description" content="Manage your email preferences for Therapair updates and communications.">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Therapair Brand Colors & Typography (Updated Design System) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --therapair-dark-navy: #0F1E4B;
            --therapair-mid-blue: #3D578A;
            --therapair-light-blue: #95B1CD;
            --therapair-black: #000000;
            --therapair-warm-beige: #FAF8F5;
            --therapair-dark-grey: #4A5568;
            
            --therapair-primary: var(--therapair-dark-navy);
            --therapair-secondary: var(--therapair-mid-blue);
            --therapair-accent: var(--therapair-light-blue);
            --therapair-gray: var(--therapair-dark-grey);
            --therapair-light-gray: var(--therapair-warm-beige);
        }
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen" style="background-color: var(--therapair-warm-beige);">
    <div class="max-w-2xl mx-auto px-4 py-12">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Email Preferences</h1>
            <p class="text-gray-600">Manage how you'd like to stay connected with Therapair</p>
        </div>

        <!-- Preference Form -->
        <div class="bg-white rounded-lg shadow-lg p-8">
            <form id="preferenceForm" action="/update-preferences.php" method="POST">
                <!-- Email Address -->
                <div class="mb-6">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        Email Address *
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0F1E4B] focus:border-transparent"
                        placeholder="your@email.com"
                    >
                </div>

                <!-- Email Preferences -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        What would you like to receive? (Select all that apply)
                    </label>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="preferences[]" value="Product Updates" checked class="mr-3 h-4 w-4 text-[#0F1E4B] focus:ring-[#0F1E4B] border-gray-300 rounded">
                            <span class="text-gray-700">Product Updates - New features and improvements</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="preferences[]" value="Therapist Opportunities" checked class="mr-3 h-4 w-4 text-[#0F1E4B] focus:ring-[#0F1E4B] border-gray-300 rounded">
                            <span class="text-gray-700">Therapist Opportunities - Join our network</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="preferences[]" value="Research & Feedback" checked class="mr-3 h-4 w-4 text-[#0F1E4B] focus:ring-[#0F1E4B] border-gray-300 rounded">
                            <span class="text-gray-700">Research & Feedback - Help shape our service</span>
                        </label>
                    </div>
                </div>

                <!-- Unsubscribe Option -->
                <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <label class="flex items-center">
                        <input type="checkbox" id="unsubscribe" name="unsubscribe" value="1" class="mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                        <span class="text-red-700 font-medium">Unsubscribe from all Therapair communications</span>
                    </label>
                    <p class="text-sm text-red-600 mt-2">Check this box to stop receiving all emails from us.</p>
                </div>

                <!-- Submit Button -->
                <div class="flex gap-4">
                    <button 
                        type="submit" 
                        class="flex-1 bg-[#0F1E4B] text-white py-3 px-6 rounded-lg hover:bg-[#2D4770] focus:ring-2 focus:ring-[#0F1E4B] focus:ring-offset-2 transition-colors font-medium"
                    >
                        Update Preferences
                    </button>
                    <button 
                        type="button" 
                        id="selectAll" 
                        class="px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                    >
                        Select All
                    </button>
                </div>
            </form>
        </div>

        <!-- Info Section -->
        <div class="mt-8 text-center text-sm text-gray-500">
            <p>You can update your preferences at any time. We respect your privacy and will never share your information.</p>
            <p class="mt-2">
                <a href="/" class="text-[#0F1E4B] hover:text-[#2D4770]">‚Üê Back to Therapair</a>
            </p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Pre-fill email from URL parameter
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const emailParam = urlParams.get('email');
            if (emailParam) {
                const emailInput = document.getElementById('email');
                if (emailInput) {
                    emailInput.value = decodeURIComponent(emailParam);
                }
            }
        })();

        // Handle unsubscribe checkbox
        document.getElementById('unsubscribe').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('input[name="preferences[]"]');
            const submitButton = document.querySelector('button[type="submit"]');
            
            if (this.checked) {
                // Uncheck all preferences
                checkboxes.forEach(cb => cb.checked = false);
                submitButton.textContent = 'Unsubscribe';
                submitButton.classList.remove('bg-[#0F1E4B]', 'hover:bg-[#2D4770]');
                submitButton.classList.add('bg-red-600', 'hover:bg-red-700');
            } else {
                // Reset button
                submitButton.textContent = 'Update Preferences';
                submitButton.classList.remove('bg-red-600', 'hover:bg-red-700');
                submitButton.classList.add('bg-[#0F1E4B]', 'hover:bg-[#2D4770]');
            }
        });

        // Handle select all button
        document.getElementById('selectAll').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('input[name="preferences[]"]');
            const unsubscribeCheckbox = document.getElementById('unsubscribe');
            
            // Uncheck unsubscribe first
            unsubscribeCheckbox.checked = false;
            
            // Check all preferences
            checkboxes.forEach(cb => cb.checked = true);
            
            // Reset submit button
            const submitButton = document.querySelector('button[type="submit"]');
            submitButton.textContent = 'Update Preferences';
            submitButton.classList.remove('bg-red-600', 'hover:bg-red-700');
            submitButton.classList.add('bg-[#0F1E4B]', 'hover:bg-[#2D4770]');
        });

        // Handle preference checkboxes
        document.querySelectorAll('input[name="preferences[]"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const unsubscribeCheckbox = document.getElementById('unsubscribe');
                if (this.checked) {
                    unsubscribeCheckbox.checked = false;
                    // Reset submit button
                    const submitButton = document.querySelector('button[type="submit"]');
                    submitButton.textContent = 'Update Preferences';
                    submitButton.classList.remove('bg-red-600', 'hover:bg-red-700');
                    submitButton.classList.add('bg-[#0F1E4B]', 'hover:bg-[#2D4770]');
                }
            });
        });

        // Form submission
        document.getElementById('preferenceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const email = formData.get('email');
            const unsubscribe = formData.get('unsubscribe');
            const preferences = formData.getAll('preferences[]');
            
            // Basic validation
            if (!email) {
                alert('Please enter your email address.');
                return;
            }
            
            if (!unsubscribe && preferences.length === 0) {
                alert('Please select at least one preference or unsubscribe.');
                return;
            }
            
            // Show loading state
            const submitButton = document.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Updating...';
            submitButton.disabled = true;
            
            // Submit form
            fetch('/update-preferences.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Redirect to confirmation page instead of popup
                    const params = new URLSearchParams({
                        email: email,
                        action: unsubscribe ? 'unsubscribe' : 'update'
                    });
                    window.location.href = '/email-preferences-confirmation.html?' + params.toString();
                } else {
                    alert('Error updating preferences: ' + (data.message || 'Please try again.'));
                    submitButton.textContent = originalText;
                    submitButton.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating preferences. Please try again.');
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            });
        });
    </script>
    
    <!-- Therapair Global Feedback Widget -->
    <script src="/therapair-feedback-widget.js" defer></script>
</body>
</html>

